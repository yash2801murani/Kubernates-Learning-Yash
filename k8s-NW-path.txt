ğŸš€ LINUX NETWORKING BASICS (Your Strong Foundation)

We will cover these 7 topics:

IP address (IPv4 basics)

Network Interface (eth0, lo, veth)

Routes & Routing Table

Default Gateway

Subnet & CIDR

NAT (SNAT & DNAT)

iptables (rules that control packets)

Letâ€™s go one by one.

âœ… 1. IP Address
â­ Simple Explanation

IP = the â€œhome addressâ€ of a device so others can reach it.

Example:
192.168.1.10

â­ Two types:

Public IP (visible on internet)

Private IP (inside your LAN)

In Kubernetes:

Pods get private IP (ex: 10.244.x.x)

Nodes have both private & sometimes public IP

â­ Command to check
ip a

âœ… 2. Network Interfaces (eth0, lo, veth)
â­ Simple Explanation

An interface is like a door from your system into the network.

Common interfaces:

eth0 â†’ main network port

lo â†’ loopback (127.0.0.1, your own machine)

vethX â†’ virtual ethernet (VERY important for containers)

â­ veth pair

A veth pair is like a telephone line:

vethA â†” vethB


Whatever enters one end comes out the other.

Kubernetes uses veth for connecting Pods â†’ host.

â­ Commands:
ip link

ğŸš€ Why Kubernetes needs interfaces?

Each Pod gets its own eth0 inside its network namespace.
It connects to the node via a veth pair.

Example:

POD(eth0) â†â†’ veth1234 â†â†’ (cni0 bridge) â†â†’ Node eth0

âœ… 3. Routing Table
â­ Simple Explanation

Routing table tells your machine:

â¡ â€œIf you want to go to X network, send packet through Y interface.â€

Example real-life:
If you want to go to Bangalore â†’ take Highway 44.
If you want to go inside city â†’ take local road.

â­ Command
ip route


Example output:

default via 192.168.1.1 dev eth0
10.244.0.0/16 dev cni0  proto kernel


Meaning:

Internet traffic â†’ gateway

Pod network â†’ cni0 bridge

â­ Why routing is critical for Kubernetes?

Pod on Node1 must reach Pod on Node2

CNI adds Pod routes automatically

For example:

10.244.1.0/24 dev cni0
10.244.2.0/24 via 10.0.0.2 dev eth0

âœ… 4. Default Gateway
â­ Simple Explanation

Gateway is the â€œexit doorâ€ from your network to outside networks.

In a house:

Door to street = gateway

In Linux:
Example:

default via 192.168.1.1 dev eth0


Meaning:
If destination is unknown â†’ send to gateway.

â­ In Kubernetes:

Pods also have a gateway (set by CNI):

Example:

Pod:

default via 10.244.1.1

âœ… 5. Subnet & CIDR
â­ Simple Explanation

CIDR tells us how many IPs belong to a network.

Example:

10.244.1.0/24


Means:

Range = 10.244.1.0 â†’ 10.244.1.255

Total 256 IPs

Used for allocating Pod IPs

ğŸš€ Kubernetes Example

Pod networks use CIDRs:

Node1 pods: 10.244.1.0/24
Node2 pods: 10.244.2.0/24
Node3 pods: 10.244.3.0/24


Each node gets its own subnet.

âœ… 6. NAT (SNAT & DNAT)
â­ Simple Explanation

NAT = Network Address Translation
Changing the source or destination IP of packets.

â­ SNAT (Source NAT)

Change source IP.

Used by Kubernetes when Pod goes to internet:

Pod IP (10.244.1.5)
â†’ becomes node IP (192.168.1.20)

â­ DNAT (Destination NAT)

Change destination IP.

Used by Kubernetes Services:

Service IP â†’ Pod IP

Example:

10.96.0.12:80 â†’ 10.244.1.6:80

â­ commands to check NAT:
iptables -t nat -L -n -v

ğŸš€ Why NAT is important for Kubernetes?

Pods need SNAT to reach internet

Services need DNAT to load balance traffic

âœ… 7. iptables (super important)
â­ Simple Explanation

iptables = firewall + NAT engine of Linux.

Kubernetes uses iptables for:

NodePort

ClusterIP

DNAT rules

kube-proxy rules

Masquerade (SNAT)

Example rule:
-A KUBE-SVC-XXXX -j KUBE-SEP-BBB


Meaning:
Service â†’ Endpoint Pod

ğŸ§  Why Linux networking is critical for Kubernetes?

Because Kubernetes does NOT implement networking.
It only expects networking to work through:

Linux routing

Linux bridge

veth

iptables

NAT

CNI plugins

If you understand Linux networking â†’
you automatically understand:

âœ” Pod-to-Pod communication
âœ” Pod-to-Node
âœ” Pod-to-Internet
âœ” Service routing
âœ” kube-proxy rules
âœ” CNI plugins (Calico, Flannel, Cilium)

ğŸ¯ Your Learning Path (Linux Networking) â€” Simple Roadmap
Day 1

Learn IP, subnet, CIDR

Practice: ip a, ip route

Day 2

Learn default gateway

Practice using minikube Podâ€™s routing table

Day 3

Learn veth pairs

Create a veth pair manually (I can give you commands)

Day 4

Learn bridge

Create Linux bridge and attach interfaces

Day 5

Learn NAT

Try SNAT, DNAT examples

Day 6

Learn iptables basics

Understand prerouting, postrouting tables


------------------------------------------------------------------------------------------------------------------------------------


STEP 2: POD NETWORKING, the heart of Kubernetes networking.

I will teach you:

âœ” Simple explanation
âœ” Real-life analogy
âœ” Technical deep working
âœ” Linux commands to inspect
âœ” What CNI does
âœ” Node view vs Pod view
âœ” Pod â†’ Pod example
âœ” Pod â†’ Internet example

After this, Pod networking will be 100% crystal clear.

ğŸš€ WHAT IS POD NETWORKING?
â­ Simple Definition

Every Pod gets its own IP address and behaves like a small virtual machine on the network.

Example:

Pod1 IP = 10.244.1.5
Pod2 IP = 10.244.2.7


Pods can ping each other directly.

â­ Kubernetes Rule

âœ” All Pods must communicate with each other
âœ” Without NAT
âœ” Across nodes

ğŸ§  Why does each Pod need its own IP?

Because Pods are:

Ephemeral (die & recreated)

Many containers (run inside Pods)

Need isolated network namespaces

So each Pod has:

its own network namespace

its own eth0 interface

its own IP

â­ Real-Life Example

Think of each Pod as a new house in a society.
It must get:

its own house number (IP)

its own door (eth0 interface)

connected to the society road (CNI bridge)

ğŸ”¥ CORE CONCEPT OF POD NETWORKING

Pod networking is built using:

veth pair

bridge (cni0)

routes

CNI plugin (Calico/Flannel/Cilium)

Letâ€™s understand with diagram.

ğŸ§µ POD NETWORKING INTERNAL DIAGRAM (Very Important)
   Pod Network Namespace                       Host Namespace
---------------------------------------------------------------
   eth0  <--------------------- veth pair ----------------> vethXYZ  
     |                                                             
     |                                                             
   Pod IP = 10.244.1.5                     cni0 bridge (virtual switch)
                                                     |
                                                     |
                                             node eth0 â†’ internet

â­ Explanation:

Pod gets eth0 interface

Host gets vethXYZ interface

Both are connected together

Host connects vethXYZ to cni0 bridge

This is done by CNI plugin (example: Flannel).

ğŸ§  How Pod Gets IP & Network Setup

When Pod starts:

1ï¸âƒ£ kubelet calls CNI plugin
2ï¸âƒ£ CNI allocates an IP (from node's pod subnet)
3ï¸âƒ£ CNI creates a veth pair
4ï¸âƒ£ One end is put inside Pod namespace (as eth0)
5ï¸âƒ£ Other end on host connects to cni0 bridge
6ï¸âƒ£ Routes added automatically
7ï¸âƒ£ Pod can now communicate to all Pods

â­ Try it in your cluster (hands-on)

Run:

k run test --image=busybox -it -- sh


Inside Pod:

ip a
ip route


Youâ€™ll see:

Pod interface:
eth0 inet 10.244.1.5/24

Pod routing:
default via 10.244.1.1

ğŸ§  How Pod â†’ Pod communication happens?
Scenario:

Pod1 on Node1 â†’ 10.244.1.5

Pod2 on Node2 â†’ 10.244.2.7

Step-by-Step Flow:
ğŸ…° Pod1 wants to send to Pod2:
curl 10.244.2.7

1. Pod sees:

"10.244.2.x is not in my subnet (10.244.1.x).
Send to default gateway 10.244.1.1"

2. Packet leaves Pod â†’ veth
Pod eth0 â†’ veth123

3. Goes to cni0 bridge on node
veth123 â†’ cni0

4. Route lookup on Node

Node routing table says:

10.244.2.0/24 via Node2

5. Packet is sent to Node2

Using nodeâ€™s network (eth0).

6. Node2 receives packet â†’ cni0 â†’ Pod2

NO NAT is used.
Pod IP remains real everywhere.

â­ POD â†’ INTERNET communication

Pod wants to reach Google.

curl google.com

Step-by-step:

Pod sends to default gateway

cni0 bridge receives it

Node does SNAT

Source 10.244.1.5 â†’ Source 192.168.1.20 (node IP)


Packet goes to internet

Return packet reaches node

Node reverses SNAT

Node â†’ Pod delivers

ğŸ§  Pod networking summary (easy lines)

âœ” Every Pod gets its own IP
âœ” Pod interface = eth0
âœ” Pod connected using veth pairs
âœ” Host uses cni0 bridge
âœ” Nodes have routing rules for Pod subnets
âœ” CNI plugin builds network
âœ” Pod-to-Pod never uses NAT
âœ” Pod-to-Internet uses SNAT

ğŸ“˜ Hands-on Commands You Must Try
See all pod interfaces:
ip link

See Pod routes:
kubectl exec -it pod -- ip route

See host routes:
ip route

See veth pair:
ip link | grep veth

See cni plugins installed:
ls /etc/cni/net.d/


----------------------------------------------------------------------------------------


3ï¸âƒ£ Routes & Routing Table (Very Simple â†’ Deep)
âœ… 1. What is a Route? (Simple Definition)

A route tells your computer:

â€œIf you want to reach this IP, send the traffic through this gateway/interface.â€

Routes = Rules for where packets should go.

âœ… 2. What is a Routing Table? (Simple Definition)

The routing table is like Google Maps for your system.
It contains all the routes your system knows.

Your laptop, server, nodes, pods â€” all have routing tables.

â­ Real-life analogy

You live in a society:

Local society roads â†’ local network

Highway â†’ default gateway

Google Maps â†’ routing table

Choosing road â†’ routing decision

If destination is nearby, go local roads.
If far away, go to highway (default route).

âœ… 3. Basic Example (Linux machine)

Run:

ip route


Output example:

default via 192.168.1.1 dev wlan0
192.168.1.0/24 dev wlan0 proto kernel scope link src 192.168.1.10


Meaning:

Destination	Action
192.168.1.0/24	send directly via wlan0 (local LAN)
default (0.0.0.0/0)	send to 192.168.1.1 â†’ to internet
âœ… 4. How routing decision works?

When packet wants to go from A â†’ B, Linux checks:

Does destination IP match any local subnet?
â†’ Send directly

Else â†’ send to default gateway

If no matching route â†’ packet dropped

5ï¸âƒ£ Deep Technical View (Linux Kernel)

Routing table is part of Linux networking stack:

L2 â†’ ARP

L3 â†’ ROUTING

L4 â†’ TCP/UDP

L7 â†’ Applications

Routing happens at L3 (IP Layer).

Routing table is stored in:

/proc/net/route


Can be seen with:

ip route show table main

6ï¸âƒ£ Types of Routes
Type	Meaning
Direct Route	destination is in your network
Default Route	used when destination is unknown
Host Route (/32)	one specific IP
Network Route	a whole subnet
Static Route	manually configured
Dynamic Route	added by a daemon (e.g., BGP)
7ï¸âƒ£ Routing in Pods (Kubernetes)

Each Kubernetes Pod also has a routing table.

Example:

default via 10.244.0.1 dev eth0
10.244.0.0/24 dev eth0 scope link


Meaning:

Route	Meaning
10.244.0.0/24	Podâ€™s own network
default via 10.244.0.1	goes to CNI plugin (flannel/calico/etc)
8ï¸âƒ£ Pod to Pod Routing Example

Assume:

Pod A: 10.244.1.5

Pod B: 10.244.2.8

Node1 CIDR: 10.244.1.0/24

Node2 CIDR: 10.244.2.0/24

Routing Decision:

A wants to reach B

A sees: not in same subnet

A sends to default route â†’ CNI

CNI on Node1 checks routing

CNI knows subnet 10.244.2.0/24 is on Node2

Sends packet to Node2

Node2 forwards packet into Pod B

9ï¸âƒ£ Routing Table in Kubernetes Nodes

Run on any node:

ip route


Example output:

default via 192.168.0.1 dev eth0
10.244.1.0/24 dev cni0  proto kernel
10.244.2.0/24 via 192.168.0.102 dev eth0


Meaning:

Packets for 10.244.1.x â†’ locally via cni0

Packets for 10.244.2.x â†’ go to node 192.168.0.102
(where that Pod subnet lives)

This is how Pod-to-Pod traffic works across nodes.

ğŸ”Ÿ Routing created by different CNIs
CNI	Routing Mechanism
Flannel	overlay network, VXLAN
Calico	BGP routes advertised between nodes
Weave	encrypted mesh overlay
Cilium	eBPF based routing (fastest)

Each CNI creates routing rules so every pod can reach every pod.

1ï¸âƒ£1ï¸âƒ£ Example: Calico Routing Table

Calico uses BGP to advertise:

10.244.1.0/24 via 192.168.0.101
10.244.2.0/24 via 192.168.0.102


Each node learns routes for all pod CIDRs.

1ï¸âƒ£2ï¸âƒ£ Example: Flannel (VXLAN) Routing Table
10.244.2.0/24 via flannel.1 dev eth0


VXLAN allows encapsulating packets â†’ overlay.

â­ Summary (Simple Memory Trick)

Routing table = Google Maps for packets

Pod routing: CNI manages it

Node routing: knows which pod network is on which node

Default route: when no specific match


----------------------------------------------------------------------------------------------------------------


âœ… 1. What is a Default Gateway? (Simple Definition)

Default Gateway is the "exit door" of your network.

When your computer/pod/server does not know where a packet should go, it sends it to:

ğŸ‘‰ Default Gateway

Default gateway =
â€œIf you donâ€™t know the route â†’ send packets here.â€

â­ 2. Real-life Analogy

Imagine your society:

Local houses (local network) â†’ direct roads

Highway (internet or outside network) â†’ default gateway

If you donâ€™t know the street â†’ go to the highway gate â†’ they know where to forward you.

That gate = default gateway

â­ 3. Basic Linux Example

Run:

ip route


Example output:

default via 192.168.1.1 dev wlan0
192.168.1.0/24 dev wlan0 scope link src 192.168.1.10


Meaning:

Route	Purpose
default via 192.168.1.1	if unknown â†’ send to 192.168.1.1
192.168.1.0/24	local LAN traffic

So 192.168.1.1 = default gateway
(usually your WiFi router).

â­ 4. When is Default Gateway used?

Case 1:
Your laptop â†’ 192.168.1.55 (same LAN)
âœ” Goes directly
âŒ Default gateway NOT used

Case 2:
Your laptop â†’ 8.8.8.8 (Google DNS)
âŒ No local route
âœ” Send to default gateway

â­ 5. What happens inside Linux when using Default Gateway?

Packet created

Kernel checks routing table

No specific route found

Kernel selects default route

Default gateway MAC is resolved using ARP

Packet sent to gateway

Gateway forwards it to next hop (ISP â†’ internet â†’ destination)

â­ 6. Why is Default Gateway important?

Without default gateway:

âŒ No internet
âŒ No outside communication
âŒ Only local LAN communication works

Default gateway is the bridge between:

Local network â†” Outside networks

â­ 7. Default Gateway inside a Kubernetes Pod

Each pod has a network namespace with a default route created by CNI.

Example:

kubectl exec -it mypod -- ip route


Output:

default via 10.244.0.1 dev eth0
10.244.0.0/24 dev eth0 scope link


Meaning:

Pod IP: 10.244.0.x

10.244.0.1 = Pod's default gateway

Created by CNI plugin (Flannel/Calico/Cilium)

Pod sends:

Pod â†’ Pod in same node â†’ direct

Pod â†’ Pod in different node â†’ via gateway

Pod â†’ ClusterIP Service â†’ via kube-proxy rules

Pod â†’ Internet â†’ via nodeâ€™s NAT

â­ 8. Default Gateway on Kubernetes Node

Run:

ip route


Example:

default via 172.31.1.1 dev eth0
10.244.1.0/24 dev cni0
10.244.2.0/24 via 172.31.1.21


Meaning:

Nodeâ€™s default gateway â†’ 172.31.1.1

Cluster pod CIDRs are directly routed

Other node's pod networks have routes via node IPs

â­ 9. How Default Gateway works with CNI Plugins
ğŸŸ¦ Flannel

Pod default gateway â†’ flannel.1 interface
VXLAN encapsulates packets â†’ sends to correct node

ğŸŸ© Calico

Pod default gateway â†’ created by calico
Calico advertises pod subnets via BGP
Nodes route packets intelligently

ğŸŸ§ Cilium

Pod default gateway â†’ eBPF program
Faster routing, bypasses kernel table

â­ 10. Summary (Memory Trick)

Default Gateway =
"Use this road if you don't know any other road."

Laptop â†’ sends unknown packets to router
Node â†’ sends unknown packets to cloud network
Pod â†’ sends unknown packets to CNI-gateway

Works the same at every level.


------------------------------------------------------------------------------------------------------------


â­ 1. What is a Subnet? (Simple)

A subnet = a smaller piece of a bigger network.

Think of:

Big society â†’ divided into smaller blocks
Network â†’ divided into smaller sub-networks

Subnet helps organize:

Pods

Nodes

Containers

VMs

Offices

â­ 2. Real-Life Example

Whole city = 10.0.0.0 â€“ 10.255.255.255

Divide it:

Block A: 10.0.0.0/24

Block B: 10.0.1.0/24

Block C: 10.0.2.0/24

Each block can hold 254 houses (IPs).

This is subnetting.

â­ 3. What is CIDR?

CIDR = Classless Inter-Domain Routing
Format:

IP_address/prefix


Example:

192.168.1.0/24


Means:

Network part = first 24 bits

Host part = last 8 bits

Total usable IPs = 254

â­ 4. Why "/24"? Why not "/16"? (Easy Explanation)

CIDR prefix = how many bits are used for NETWORK

/8 = Very big network

/16 = Medium

/24 = Small

/32 = Only 1 IP (used for single host/pod)

â­ 5. Example Breakdown
10.244.0.0/24


This means:

Part	Meaning
10.244.0.0	Network ID
/24	24 bits = network
Hosts allowed	254
Broadcast	10.244.0.255
First usable	10.244.0.1
Last usable	10.244.0.254
â­ 6. A Very Simple CIDR Table to Remember
CIDR	Host IPs	For what?
/32	1	Single Pod/Host Identity
/30	2 usable	Point-to-point links
/24	254 usable	Pod subnet (common)
/20	4094 usable	Node subnet
/16	65,534 usable	Organization network
â­ 7. Subnet & CIDR in Kubernetes

K8s uses subnets everywhere:

ğŸŸ¦ 1. Node subnet

Example:

Node-1 gets Pod CIDR: 10.244.1.0/24
Node-2 gets Pod CIDR: 10.244.2.0/24
Node-3 gets Pod CIDR: 10.244.3.0/24


Each node gets its own subnet for pods.

ğŸŸ© 2. Pod subnet inside one node

Example:
Node-1 pods:

10.244.1.2
10.244.1.3
10.244.1.4


All from subnet:

10.244.1.0/24

ğŸŸª 3. Service subnet

Cluster services live in this range:

Example:

10.96.0.0/12


Service ClusterIPs come from here:

kube-dns â†’ 10.96.0.10

kube-api â†’ 10.96.0.1

â­ 8. Why K8s needs Subnets + CIDR?

To ensure:

âœ” Pods get unique IPs
âœ” Nodes know how to route pod traffic
âœ” Services have stable virtual IPs
âœ” CNI plugins manage networking correctly
âœ” No IP overlap between nodes

Without subnets, Kubernetes will break.

â­ 9. Deep Technical View
A CIDR defines:

Network bits (unchangeable)

Host bits (assignable)

Routing boundary

Broadcast address

Example:

10.244.2.5 in 10.244.2.0/24


Binary form:

Network (24 bits) | Host (8 bits)
10.244. 2 . 00000101


Mask:

255.255.255.0

â­ 10. Super Simple Memory Trick
IP + /number = how big the network is


Smaller number = big network
Bigger number = small network

CIDR	Size
/8	Huge
/16	Large
/24	Medium
/30	Tiny
/32	Single IP


------------------------------------------------------------------------------------------------

â­ 1. What is NAT? (Very Simple)

NAT = Network Address Translation

It changes IP addresses in packets.

Why?

Because:

Private IPs cannot go to the internet

One public IP = many devices inside network

Need to expose services externally

So NAT = device that rewrites IPs.

â­ 2. Real-LIFE Example (You will never forget)

You and your friends live in one house:

Inside house names â†’ private IPs

Outside world sees one surname â†’ public IP

When packet goes out:

Inside	Outside
Yash	Patel family
Nency	Patel family
Krish	Patel family

House address becomes the public identity â†’ NAT

Same in networking:

Inside private IP: 192.168.1.10

Public IP: 100.10.2.3

NAT converts:

192.168.1.10 â†’ 100.10.2.3

â­ 3. Types of NAT in Simple Words
1) SNAT â†’ Source NAT

Changes source IP of packet.

When used?
â¡ï¸ For outgoing traffic (Pod â†’ Internet)

Example:

Pod IP: 10.244.1.5 â†’ outgoing to internet
Node public IP: 3.110.5.22


SNAT changes:

SRC: 10.244.1.5 â†’ 3.110.5.22


So internet servers reply back to the node, and node sends back to pod.

2) DNAT â†’ Destination NAT

Changes destination IP of packet.

When used?
â¡ï¸ For incoming traffic (Internet â†’ Pod/Service)

Example:

User hits NodePort:

Public-IP:30080


Node does DNAT:

DST: Public-IP:30080 â†’ Pod-IP:10.244.1.5:80


This is how external traffic reaches pods.

â­ 4. SNAT & DNAT: Super Simple Diagram
POD â†’ (SNAT) â†’ Internet
Internet â†’ (DNAT) â†’ POD

â­ 5. Detailed Examples (Easy but Technical)
ğŸ”µ SNAT Example (Pod going to internet)

Pod:

SRC: 10.244.2.5
DST: 8.8.8.8


Node does SNAT:

SRC: 3.110.5.22 (node public IP)
DST: 8.8.8.8


Why?
Because 10.x.x.x is private â†’ cannot reach internet.

ğŸ”´ DNAT Example (User hitting NodePort)

User â†’

SRC: 122.10.5.6
DST: <node-ip>:30080


Node does DNAT:

DST: 10.244.1.5:80 (pod IP)


So web request reaches the pod.

â­ 6. NAT inside Kubernetes (Very Important)
1ï¸âƒ£ SNAT in Kubernetes

Used when pod sends traffic outside:

Pod â†’ Internet
Pod â†’ External DB
Pod â†’ External API

Nodeâ€™s kube-proxy or CNI plugin SNATs pod IP to:

Node private IP

Or Node public IP

Or Masquerade IP

Command to see SNAT rules:

iptables -t nat -L -n --line-numbers


Look for:

MASQUERADE

2ï¸âƒ£ DNAT in Kubernetes

Used when external traffic comes in:

NodePort example:
<node-ip>:30080


Node uses DNAT to forward to:

pod-ip:80

ClusterIP example:

Pod hits:

ClusterIP:80


kube-proxy = adds DNAT:

ClusterIP:80 â†’ PodIP:80


ClusterIP exists ONLY through DNAT rules.

â­ 7. NAT in Kubernetes Service Types
Service Type	NAT Used	How
ClusterIP	DNAT	ClusterIP â†’ PodIP
NodePort	DNAT	NodePort â†’ PodIP
LoadBalancer	DNAT	LB â†’ NodePort â†’ Pod
ExternalTrafficPolicy=Local	DNAT bypass	Keeps client real IP
Pod â†’ Internet	SNAT	PodIP â†’ NodeIP
â­ 8. Deep Technical Flow (Pod â†’ Internet)
Step-by-Step:

Pod creates packet

SRC: 10.244.1.3 â†’ DST: 8.8.8.8


CNI routes to node

Node applies SNAT

SRC: <node-ip>


Packet reaches internet

Response returns to node

Node de-SNATs

DST: 10.244.1.3


Pod receives packet

â­ 9. Deep Technical Flow (User â†’ Pod via NodePort)

User sends request:

DST: <node-ip>:30080


Node uses DNAT:

â†’ pod-ip:80


Response packet uses conntrack to send reply back correctly.

â­ 10. Quick Memory Trick
SNAT = Source NAT

â¡ï¸ "Change source IP"
â¡ï¸ Pod going OUT

DNAT = Destination NAT

â¡ï¸ "Change destination IP"
â¡ï¸ User traffic coming IN


------------------------------------------------------------------------------------------------------------------------------------------------


â­ 1. What is iptables? (Simple Definition)

iptables is a firewall + traffic controller inside Linux.

It decides:

âœ” Allow packet

âŒ Drop packet

ğŸ” Forward packet

ğŸ”„ NAT (change IPs)

â†ª Redirect traffic

You can think of iptables as:

â€œThe traffic police inside the Linux kernel.â€

â­ 2. Real-Life Analogy

At a society gate:

Security checks every car

Allows some

Blocks some

Redirects visitors

Logs events

This is exactly what iptables does for network packets.

â­ 3. iptables = Rules + Chains + Tables

This is the MOST important thing to understand.

iptables is made of:

âœ” Tables (groups of rules)
âœ” Chains (traffic flow paths)
âœ” Rules (what to do)
â­ 4. Tables in iptables (VERY IMPORTANT)
Table	Purpose
filter	Allow/deny packets (firewall)
nat	NAT (SNAT, DNAT, MASQUERADE)
mangle	Change packet headers (TOS, mark)
raw	Bypass connection tracking
security	SELinux (rarely used)

In Kubernetes, the filter and nat tables are the most important.

â­ 5. Chains (Packet Flow Path)

Each table has chains.

âœ³ï¸ filter table (firewall)

INPUT

OUTPUT

FORWARD

âœ³ï¸ nat table (NAT rules)

PREROUTING â†’ DNAT

POSTROUTING â†’ SNAT

OUTPUT

â­ 6. Very Simple Diagram
Packet enters â†’ PREROUTING â†’ INPUT/FORWARD â†’ POSTROUTING â†’ Out
                   â”‚               â”‚               â”‚
                 DNAT          Firewall          SNAT


This shows when DNAT or SNAT happens.

â­ 7. Easy Example
â— Drop all traffic from 1.2.3.4
iptables -A INPUT -s 1.2.3.4 -j DROP


Meaning:

In INPUT chain

If source IP is 1.2.3.4

Drop the packet

âœ” Allow port 80
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

â­ 8. NAT Examples (VERY IMPORTANT)
ğŸ”µ DNAT Example (NodePort)
iptables -t nat -A PREROUTING -p tcp --dport 30080 -j DNAT --to-destination 10.244.1.5:80

ğŸ”´ SNAT Example (Pod â†’ Internet)
iptables -t nat -A POSTROUTING -s 10.244.0.0/16 -j MASQUERADE

â­ 9. Why iptables is important in Kubernetes?

Kubernetes heavily depends on iptables:

Component	Uses iptables for
kube-proxy	Service routing (ClusterIP DNAT, NodePort DNAT)
CNI plugins	NAT for Pod â†’ Internet
NetworkPolicy	Firewall rules for pods
Ingress controllers	Redirection rules
LoadBalancer	NodePort translation
â­ 10. kube-proxy with iptables (SUPER IMPORTANT)
When you create a ClusterIP service:

Example:

ClusterIP: 10.96.0.5:80


kube-proxy adds DNAT rules like:

10.96.0.5:80 â†’ pod1:80
10.96.0.5:80 â†’ pod2:80


So kube-proxy uses iptables chains:

KUBE-SERVICES

KUBE-SEP-*

KUBE-PORTALS

KUBE-NODEPORTS

â­ 11. Example: Pod â†’ Pod via Service

Pod calls:

curl http://10.96.0.5


iptables flow:

Packet â†’ PREROUTING â†’ KUBE-SERVICES â†’ DNAT to PodIP â†’ FORWARD â†’ Pod


Thatâ€™s how the virtual ClusterIP works.

â­ 12. How to see iptables rules?
NAT table
iptables -t nat -L -n --line-numbers

Filter table
iptables -t filter -L -n

Show all rules
iptables-save

â­ 13. Summary You Should Remember Forever
âœ” iptables = Linux firewall + packet control
âœ” Kubernetes uses iptables for:

ClusterIP

NodePort

LoadBalancer

Pod egress SNAT

NetworkPolicy

Ingress

âœ” NAT happens using:

PREROUTING â†’ DNAT

POSTROUTING â†’ SNAT

âœ” kube-proxy modifies iptables for service load-balancing

If iptables breaks â†’ Kubernetes networking breaks.


------------------------------------------------


ğŸšª Ingress in Kubernetes (Simple Explanation)

Ingress = Entry Gate of Your Kubernetes Cluster

When traffic comes from the internet, it cannot directly reach your pods.
Ingress acts like a smart traffic controller (HTTP/HTTPS router) that decides:

Which request should go to which service?

Based on domain name (host)

Based on path (/login, /api, /app)

With TLS/SSL (HTTPS)

ğŸ§  Why do we need Ingress?

Without ingress:

You must expose each service using NodePort or LoadBalancer

Each service gets its own port â†’ messy & costly

With ingress:

You expose only one external IP

Handle multiple routes & domains from a single place

ğŸ§± Ingress Components

1ï¸âƒ£ Ingress Resource
â†’ YAML file that contains routing rules (host/path â†’ service).

2ï¸âƒ£ Ingress Controller
â†’ The actual software that implements those rules.
Examples: NGINX Ingress Controller, Traefik, HAProxy.

Note: Without an ingress controller installed, ingress does not work.

ğŸ›£ï¸ Simple Example

You have 2 services:

app1-service (for domain: app1.yash.com)

app2-service (for domain: app2.yash.com)

Ingress rules decide where to send traffic.

ğŸ“„ Ingress YAML (Simple Example)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - host: app1.yash.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app1-service
            port:
              number: 80

  - host: app2.yash.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app2-service
            port:
              number: 80

ğŸ¯ Real-World Analogy

Imagine a big office building:

Ingress Controller = Security Guard at the main gate

Ingress Rules = Instructions:

People saying â€œApp1â€ â†’ 1st floor

People saying â€œApp2â€ â†’ 2nd floor

Only one gate, but many destinations.

ğŸ›¡ï¸ Ingress + TLS (HTTPS)

Ingress can manage SSL certificates.
Example using TLS secret:

tls:
- hosts:
  - app1.yash.com
  secretName: my-tls-secret


K8s stores the certificate in a Secret.

ğŸš€ Key Benefits of Ingress
Feature	Description
One external IP	All apps access using single entry point
Routing rules	Based on domain & path
TLS/SSL	HTTPS for security
Load balancing	Built-in with controller
Cost effective	Fewer LoadBalancers
ğŸ§ª Commands to Work With Ingress

â–¶ï¸ Check ingress:

kubectl get ingress


â–¶ï¸ Describe ingress:

kubectl describe ingress my-ingress


â–¶ï¸ Apply YAML:

kubectl apply -f ingress.yaml

âš ï¸ IMPORTANT

Ingress does not work unless you install an Ingress Controller.

Most common:

helm install nginx-ingress ingress-nginx/ingress-nginx------------------------------------------------------------------------------------------------